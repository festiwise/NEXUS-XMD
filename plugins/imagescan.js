constaxios=require("axios");constFormData=require('form-data');constfs=require('fs');constos=require('os');constpath=require("path");const{cmd}=require("../command");//HelperfunctiontoformatbytesfunctionformatBytes(bytes){if(bytes===0)return'0Bytes';constk=1024;constsizes=['Bytes','KB','MB','GB'];consti=Math.floor(Math.log(bytes)/Math.log(k));returnparseFloat((bytes/Math.pow(k,i)).toFixed(2))+''+sizes[i];}cmd({pattern:"imgscan",alias:["scanimg","imagescan","analyzeimg"],react:'🔍',desc:"ScanandanalyzeimagesusingAI",category:"utility",use:".imgscan[replytoimage]",filename:__filename},async(client,message,{reply,quoted})=>{try{//CheckifquotedmessageexistsandhasmediaconstquotedMsg=quoted||message;constmimeType=(quotedMsg.msg||quotedMsg).mimetype||'';if(!mimeType||!mimeType.startsWith('image/')){returnreply("Pleasereplytoanimagefile(JPEG/PNG)");}//DownloadthemediaconstmediaBuffer=awaitquotedMsg.download();constfileSize=formatBytes(mediaBuffer.length);//Getfileextensionbasedonmimetypeletextension='';if(mimeType.includes('image/jpeg'))extension='.jpg';elseif(mimeType.includes('image/png'))extension='.png';else{returnreply("Unsupportedimageformat.PleaseuseJPEGorPNG");}consttempFilePath=path.join(os.tmpdir(),`imgscan_${Date.now()}${extension}`);fs.writeFileSync(tempFilePath,mediaBuffer);//UploadtoCatboxconstform=newFormData();form.append('fileToUpload',fs.createReadStream(tempFilePath),`image${extension}`);form.append('reqtype','fileupload');constuploadResponse=awaitaxios.post("https://catbox.moe/user/api.php",form,{headers:form.getHeaders()});constimageUrl=uploadResponse.data;fs.unlinkSync(tempFilePath);//Cleanuptempfileif(!imageUrl){throw"FailedtouploadimagetoCatbox";}//ScantheimageusingtheAPIconstscanUrl=`https://apis.davidcyriltech.my.id/imgscan?url=${encodeURIComponent(imageUrl)}`;constscanResponse=awaitaxios.get(scanUrl);if(!scanResponse.data.success){throwscanResponse.data.message||"Failedtoanalyzeimage";}//Formattheresponseawaitreply(`🔍*ImageAnalysisResults*\n\n`+`${scanResponse.data.result}\n\n`+`>©PoweredbyPkdriller✅`);}catch(error){console.error('ImageScanError:',error);awaitreply(`❌Error:${error.message||error}`);}});